{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../GameDo/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"index-container\">\n    <!-- ÊêúÁ¥¢Ê°Ü -->\n    <search-bar \n      v-model=\"searchText\" \n      placeholder=\"ÊêúÁ¥¢‰∫ßÂìÅ\" \n      @clear=\"searchText = ''\"\n      @input=\"onSearch\"\n      @confirm=\"onSearchConfirm\" \n    />\n    \n    <!-- Á≠õÈÄâÊ†è -->\n    <filter-bar \n      :selectedFilter=\"currentFilter\"\n      @filter-change=\"handleFilterChange\"\n    />\n    \n    <!-- ‰∫ßÂìÅÂç°ÁâáÂàóË°® -->\n      <view class=\"product-list\">\n      <loading-animation :loading=\"isLoading\" text=\"Âä†ËΩΩ‰∫ßÂìÅ‰∏≠...\" />\n      \n      <product-card\n        v-for=\"product in sortedProducts\"\n        :key=\"product.product_id\"\n        :product=\"product\"\n        :price=\"getProductTotalCost(product.product_id)\"\n        :expiry-date=\"formatExpiryDate(product.expiry_date)\"\n        @view=\"handleViewProduct\"\n        v-if=\"!isLoading\"\n      />\n      <view v-if=\"sortedProducts.length === 0 && !isLoading\" class=\"empty-tip\">\n        <text class=\"empty-icon\">üì≠</text>\n        <text>ÊöÇÊó†Áõ∏ÂÖ≥‰∫ßÂìÅ</text>\n      </view>\n      </view>\n      \n    <!-- Â∫ïÈÉ®ËèúÂçïÊ†è -->\n    <tab-bar :current-tab=\"0\" @tab-change=\"handleTabChange\" />\n  </view>\n</template>\n\n<script>\nimport { mapActions } from 'vuex'\nimport SearchBar from '../../components/SearchBar.vue'\nimport FilterBar from '../../components/FilterBar.vue'\nimport ProductCard from '../../components/ProductCard.vue'\nimport TabBar from '../../components/TabBar.vue'\nimport LoadingAnimation from '../../components/LoadingAnimation.vue'\nimport { get } from '../../utils/request'\nimport dayjs from 'dayjs'\n\nexport default {\n  name: 'Index',\n  components: {\n    SearchBar,\n    FilterBar,\n    ProductCard,\n    TabBar,\n    LoadingAnimation\n  },\n  data() {\n    return {\n      products: [],\n      quotes: [],\n      searchText: '',\n      productId: null,\n      isLoading: true,\n      currentFilter: 'default'\n    }\n  },\n  computed: {\n    filteredProducts() {\n      if (!this.searchText) return this.products\n      return this.products.filter(p => \n        p.product_name.toLowerCase().includes(this.searchText.toLowerCase()) || \n        p.description?.toLowerCase().includes(this.searchText.toLowerCase())\n      )\n    },\n    sortedProducts() {\n      const products = [...this.filteredProducts];\n      \n      // Ê£ÄÊü•ÂΩìÂâçÁ≠õÈÄâÊù°‰ª∂ÊòØÂê¶ÊòØÂ§çÂêàÁ≠õÈÄâÔºàJSONÂ≠óÁ¨¶‰∏≤Ôºâ\n      if (typeof this.currentFilter === 'string' && this.currentFilter.startsWith('{')) {\n        try {\n          // Ëß£ÊûêÂ§çÂêàÁ≠õÈÄâÊù°‰ª∂\n          const filters = JSON.parse(this.currentFilter);\n          \n          // Â∫îÁî®Â§çÂêàÁ≠õÈÄâÊù°‰ª∂\n          return this.applyComplexFilters(products, filters);\n        } catch (error) {\n          console.error('Ëß£ÊûêÁ≠õÈÄâÊù°‰ª∂Âá∫Èîô:', error);\n          return products;\n        }\n      }\n      \n      // Âçï‰∏ÄÁ≠õÈÄâÊù°‰ª∂\n      switch (this.currentFilter) {\n        case 'priceHigh': // ‰ª∑Ê†º‰ªéÈ´òÂà∞‰Ωé\n          return products.sort((a, b) => {\n            const priceA = this.getProductTotalCostNumber(a.product_id);\n            const priceB = this.getProductTotalCostNumber(b.product_id);\n            return priceB - priceA;\n          });\n          \n        case 'priceLow': // ‰ª∑Ê†º‰ªé‰ΩéÂà∞È´ò\n          return products.sort((a, b) => {\n            const priceA = this.getProductTotalCostNumber(a.product_id);\n            const priceB = this.getProductTotalCostNumber(b.product_id);\n            return priceA - priceB;\n          });\n          \n        case 'dateFar': // Êà™Ê≠¢Êó•Êúü‰ªéËøúÂà∞Ëøë\n          return products.sort((a, b) => {\n            const dateA = a.expiry_date ? new Date(a.expiry_date).getTime() : 0;\n            const dateB = b.expiry_date ? new Date(b.expiry_date).getTime() : 0;\n            return dateB - dateA;\n          });\n          \n        case 'dateNear': // Êà™Ê≠¢Êó•Êúü‰ªéËøëÂà∞Ëøú\n          return products.sort((a, b) => {\n            const dateA = a.expiry_date ? new Date(a.expiry_date).getTime() : 0;\n            const dateB = b.expiry_date ? new Date(b.expiry_date).getTime() : 0;\n            return dateA - dateB;\n          });\n          \n        default: // ÈªòËÆ§ÊéíÂ∫è\n          return products;\n      }\n    }\n  },\n  onLoad(options) {\n    this.productId = options.id\n    this.fetchProducts()\n    this.fetchQuotes()\n  },\n  methods: {\n    ...mapActions('product', ['fetchProducts']),\n    async fetchProducts() {\n      this.isLoading = true\n      try {\n        const res = await get('/products')\n        this.products = res.data\n      } catch (error) {\n        uni.showToast({\n          title: error.message || 'Ëé∑Âèñ‰∫ßÂìÅÂàóË°®Â§±Ë¥•',\n          icon: 'none'\n        })\n      } finally {\n        setTimeout(() => {\n          this.isLoading = false\n        }, 500) // Ê∑ªÂä†Âª∂ËøüÔºå‰ΩøÂä®ÁîªÊïàÊûúÊõ¥ÊòéÊòæ\n      }\n    },\n    async fetchQuotes() {\n      try {\n        const res = await get('/quotes')\n        this.quotes = res.data\n      } catch (error) {\n        // ÂèØÂøΩÁï•\n      }\n    },\n    handleViewProduct(id) {\n      uni.navigateTo({ url: `/pages/product/detail?id=${id}` })\n    },\n    handleTabChange(index) {\n      // È°µÁ≠æÂàáÊç¢Â§ÑÁêÜÔºåÂ∑≤ÁßªÈô§‰∏âËßíËèúÂçïÁõ∏ÂÖ≥ÈÄªËæë\n    },\n    // Á≠õÈÄâÁõ∏ÂÖ≥ÊñπÊ≥ï\n    handleFilterChange(filter) {\n      this.currentFilter = filter;\n    },\n    // Ëé∑Âèñ‰∫ßÂìÅÊúÄ‰ΩéÊä•‰ª∑\n    getProductTotalCost(productId) {\n      const quote = this.quotes.filter(q => q.product_id === productId)\n      if (!quote.length) return '-'\n      // ÂèñÊúÄ‰ΩéÊÄª‰ª∑\n      return Math.min(...quote.map(q => q.total_cost))\n    },\n    // Ëé∑Âèñ‰∫ßÂìÅÊúÄ‰ΩéÊä•‰ª∑(Êï∞Â≠ó)ÔºåÁî®‰∫éÊéíÂ∫è\n    getProductTotalCostNumber(productId) {\n      const quote = this.quotes.filter(q => q.product_id === productId)\n      if (!quote.length) return 0\n      // ÂèñÊúÄ‰ΩéÊÄª‰ª∑\n      return Math.min(...quote.map(q => q.total_cost))\n    },\n    formatExpiryDate(expiryDate) {\n      if (!expiryDate) return '-'\n      return dayjs(expiryDate).format('YYYY-MM-DD')\n    },\n    // Â∫îÁî®Â§çÂêàÁ≠õÈÄâÊù°‰ª∂\n    applyComplexFilters(products, filters) {\n      let result = [...products];\n      \n      // ÂÖàÂ∫îÁî®‰ª∑Ê†ºÁ≠õÈÄâ\n      if (filters.price === 'high') {\n        result.sort((a, b) => {\n          const priceA = this.getProductTotalCostNumber(a.product_id);\n          const priceB = this.getProductTotalCostNumber(b.product_id);\n          return priceB - priceA;\n        });\n      } else if (filters.price === 'low') {\n        result.sort((a, b) => {\n          const priceA = this.getProductTotalCostNumber(a.product_id);\n          const priceB = this.getProductTotalCostNumber(b.product_id);\n          return priceA - priceB;\n        });\n      }\n      \n      // Â¶ÇÊûúÂêåÊó∂ÊúâÊó•ÊúüÁ≠õÈÄâÔºåÈúÄË¶ÅÁ®≥ÂÆöÊéíÂ∫è‰øùÊåÅ‰ª∑Ê†ºÊéíÂ∫èÁöÑÁªìÊûú\n      if (filters.date !== null) {\n        // ‰ΩøÁî®Ëá™ÂÆö‰πâÁ®≥ÂÆöÊéíÂ∫èÔºå‰øùÊåÅ‰ª∑Ê†ºÊéíÂ∫èÁöÑÁªìÊûú\n        result = this.stableSortByDate(result, filters.date);\n      }\n      \n      return result;\n    },\n    \n    // Á®≥ÂÆöÊéíÂ∫èÊåâÊó•ÊúüÔºà‰øùÊåÅ‰ª∑Ê†ºÊéíÂ∫èÁöÑÁªìÊûúÔºâ\n    stableSortByDate(products, dateFilter) {\n      // ÂàõÂª∫Â∏¶Á¥¢ÂºïÁöÑÊï∞ÁªÑÔºå‰øùÂ≠òÂéüÂßãÈ°∫Â∫è\n      const indexed = products.map((item, index) => ({ item, index }));\n      \n      // Ê†πÊçÆÊó•ÊúüÂíåÂéüÂßãÁ¥¢ÂºïÊéíÂ∫è\n      indexed.sort((a, b) => {\n        const dateA = a.item.expiry_date ? new Date(a.item.expiry_date).getTime() : 0;\n        const dateB = b.item.expiry_date ? new Date(b.item.expiry_date).getTime() : 0;\n        \n        // Êó•ÊúüÊéíÂ∫è\n        const dateDiff = dateFilter === 'far' ? (dateB - dateA) : (dateA - dateB);\n        \n        // Â¶ÇÊûúÊó•ÊúüÁõ∏ÂêåÔºå‰øùÊåÅÂéüÂßãÈ°∫Â∫è\n        return dateDiff !== 0 ? dateDiff : (a.index - b.index);\n      });\n      \n      // ËøîÂõûÊéíÂ∫èÂêéÁöÑ‰∫ßÂìÅ\n      return indexed.map(x => x.item);\n    },\n    // Ê∑ªÂä†ÊêúÁ¥¢Â§ÑÁêÜÊñπÊ≥ï\n    onSearch(value) {\n      this.searchText = value;\n      // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÊêúÁ¥¢Âª∂ËøüÊàñÂÖ∂‰ªñÂ§ÑÁêÜÈÄªËæë\n    },\n    \n    // Ê∑ªÂä†ÊêúÁ¥¢Á°ÆËÆ§ÊñπÊ≥ï\n    onSearchConfirm(value) {\n      this.searchText = value;\n      uni.showToast({\n        title: 'ÊêúÁ¥¢: ' + value,\n        icon: 'none',\n        duration: 2000\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '../../styles/theme.scss';\n\n.index-container {\n  min-height: 100vh;\n  background-color: $bg-secondary;\n  padding-bottom: 120rpx;\n}\n\n.product-list {\n  padding: 24rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.empty-tip {\n  margin-top: 100rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  color: $text-light;\n  \n  .empty-icon {\n    font-size: 120rpx;\n    margin-bottom: 24rpx;\n    opacity: 0.6;\n  }\n  \n  text {\n    font-size: $font-size-md;\n  }\n}\n</style> ","import MiniProgramPage from 'D:/orderMySelf/product-price/product-price/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","mapActions","get","dayjs"],"mappings":"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"}