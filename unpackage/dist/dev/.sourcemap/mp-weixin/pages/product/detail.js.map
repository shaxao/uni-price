{"version":3,"file":"detail.js","sources":["pages/product/detail.vue","../../../GameDo/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZHVjdC9kZXRhaWwudnVl"],"sourcesContent":["<template>\n  <view class=\"edit-container\">\n    <loading-animation :loading=\"isLoading\" text=\"加载产品详情...\" />\n    <view class=\"content-wrapper\" v-if=\"!isLoading\">\n      <!-- 页面标题 -->\n      <view class=\"page-header\">\n        <text class=\"page-title\">产品详情</text>\n        <text class=\"page-subtitle\">查看产品详细信息及操作</text>\n        </view>\n      <base-card class=\"form-card\">\n        <view class=\"form-content\">\n          <view class=\"form-row\">\n            <image :src=\"product.product_image\" class=\"product-image\" mode=\"aspectFill\" />\n            <view class=\"product-info-main\">\n              <text class=\"product-title\">{{ product.product_name }}</text>\n              <text class=\"product-desc\">{{ product.description }}</text>\n              <text class=\"product-expiry\">截止日期：{{ formatDate(product.expiry_date) }}</text>\n          </view>\n          </view>\n          <view class=\"info-section\">\n            <text class=\"section-title\">基本信息</text>\n            <view class=\"info-item\"><text class=\"label\">产品品号：</text><text class=\"value\">{{ product.product_id }}</text></view>\n            <view class=\"info-item\"><text class=\"label\">仓库地址：</text><text class=\"value\">{{ product.warehouse }}</text></view>\n            <view class=\"info-item\"><text class=\"label\">邮编：</text><text class=\"value\">{{ product.zipcode }}</text></view>\n          </view>\n        <view class=\"info-section\">\n          <text class=\"section-title\">尺寸信息</text>\n          <view class=\"info-grid\">\n              <view class=\"info-item\"><text class=\"label\">长度：</text><text class=\"value\">{{ product.length }}cm</text></view>\n              <view class=\"info-item\"><text class=\"label\">宽度：</text><text class=\"value\">{{ product.width }}cm</text></view>\n              <view class=\"info-item\"><text class=\"label\">高度：</text><text class=\"value\">{{ product.height }}cm</text></view>\n            </view>\n          </view>\n        <view class=\"info-section\">\n          <text class=\"section-title\">重量信息</text>\n          <view class=\"info-grid\">\n              <view class=\"info-item\"><text class=\"label\">毛重：</text><text class=\"value\">{{ product.gross_weight }}kg</text></view>\n              <view class=\"info-item\"><text class=\"label\">箱体重：</text><text class=\"value\">{{ product.package_weight }}kg</text></view>\n              <view class=\"info-item\"><text class=\"label\">计费重：</text><text class=\"value\">{{ product.chargeable_weight }}kg</text></view>\n            </view>\n          </view>\n        <view class=\"info-section\">\n          <text class=\"section-title\">数量信息</text>\n          <view class=\"info-grid\">\n              <view class=\"info-item\"><text class=\"label\">装箱量：</text><text class=\"value\">{{ product.box_quantity || '-' }}</text></view>\n              <view class=\"info-item\"><text class=\"label\">单位数量：</text><text class=\"value\">{{ product.unit_quantity || '-' }}</text></view>\n              <view class=\"info-item\"><text class=\"label\">总件数：</text><text class=\"value\">{{ product.total_quantity }}</text></view>\n            </view>\n          </view>\n        <view class=\"info-section\">\n          <text class=\"section-title\">总量信息</text>\n          <view class=\"info-grid\">\n              <view class=\"info-item\"><text class=\"label\">总体积：</text><text class=\"value\">{{ product.total_volume }}m³</text></view>\n              <view class=\"info-item\"><text class=\"label\">总毛重：</text><text class=\"value\">{{ product.total_gross_weight }}kg</text></view>\n            </view>\n          </view>\n        </view>\n      </base-card>\n      <!-- 费用摘要卡片（如有报价信息可展示） -->\n      <view class=\"summary-card\" v-if=\"product.min_quote\">\n        <view class=\"summary-title\">最低报价摘要</view>\n        <view class=\"summary-item\">\n          <text class=\"item-label\">最低报价</text>\n          <text class=\"item-value\">￥{{ product.min_quote.price_per_kg }}/kg</text>\n        </view>\n        <view class=\"summary-item\">\n          <text class=\"item-label\">最快时效</text>\n          <text class=\"item-value\">{{ product.min_quote.delivery_time }}</text>\n      </view>\n        <view class=\"summary-divider\"></view>\n        <view class=\"summary-item total\">\n          <text class=\"item-label\">总费用</text>\n          <text class=\"item-value\">￥{{ product.min_quote.total_cost }}</text>\n        </view>\n      </view>\n      <!-- 底部操作按钮组 -->\n      <view class=\"action-buttons\">\n        <button class=\"action-btn secondary\" @click=\"handleCartAction\" :disabled=\"isInCart\">\n          <text class=\"btn-icon\">🛒</text>\n          <text>{{ isInCart ? '已在购物车' : '加入购物车' }}</text>\n        </button>\n        <button class=\"action-btn primary\" @click=\"navigateToQuote\">\n          <text class=\"btn-icon\">💰</text>\n          <text>提交报价</text>\n        </button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { mapActions, mapState, mapGetters } from 'vuex'\nimport BaseCard from '../../components/BaseCard.vue'\nimport LoadingAnimation from '../../components/LoadingAnimation.vue'\nimport dayjs from 'dayjs'\nimport { get } from '../../utils/request'\n\nexport default {\n  name: 'ProductDetail',\n  components: {\n    BaseCard,\n    LoadingAnimation\n  },\n  data() {\n    return {\n      productId: '',\n      product: {},\n      isLoading: true\n    }\n  },\n  computed: {\n    ...mapState('cart', ['cartItems']),\n    ...mapGetters('product', ['getProductById']),\n    isInCart() {\n      return this.cartItems && this.cartItems.some(item => item.productId === this.productId)\n    },\n    cachedProduct() {\n      if (!this.getProductById || typeof this.getProductById !== 'function') {\n        return null;\n      }\n      try {\n        const product = this.getProductById(this.productId);\n        return product || null;\n      } catch (e) {\n        console.error('获取缓存产品失败:', e);\n        return null;\n      }\n    }\n  },\n  onLoad(options) {\n    this.productId = options.id\n    this.fetchProductDetail()\n    this.loadCartItems() // 确保加载最新的购物车数据\n  },\n  methods: {\n    ...mapActions('cart', {\n      cartAddToCart: 'addToCart',  // 重命名Vuex action，避免命名冲突\n      loadCartItems: 'loadCartItems'\n    }),\n    ...mapActions('product', ['fetchProduct']),\n    async fetchProductDetail() {\n      this.isLoading = true\n      try {\n        // 先尝试从Vuex缓存获取\n        if (this.cachedProduct) {\n          this.product = this.cachedProduct\n          setTimeout(() => {\n            this.isLoading = false\n          }, 300)\n          return\n        }\n        \n        // 如果缓存没有，则从API获取\n        await this.fetchProduct(this.productId)\n        if (this.cachedProduct) {\n          this.product = this.cachedProduct\n        } else {\n          // 模拟数据\n          const mockData = {\n            product_id: this.productId,\n            product_name: \"智能手表 Pro Max\",\n            description: \"多功能健康监测智能手表，支持心率、血压、血氧监测\",\n            product_image: \"https://cdn.example.com/img/watch.jpg\",\n            expiry_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n            warehouse: \"上海仓\",\n            zipcode: \"200001\",\n            length: 5.5,\n            width: 4.2,\n            height: 1.8,\n            gross_weight: 0.35,\n            package_weight: 0.15,\n            chargeable_weight: 0.5,\n            box_quantity: 50, // 新增装箱量\n            unit_quantity: 200, // 新增单位数量\n            total_quantity: 1000,\n            total_volume: 2.5,\n            total_gross_weight: 350,\n            min_quote: {\n              price_per_kg: 45,\n              delivery_time: \"7-10工作日\",\n              total_cost: 15750\n            }\n          };\n          this.product = mockData;\n        }\n      } catch (error) {\n        uni.showToast({\n          title: error.message || '获取产品详情失败',\n          icon: 'none'\n        })\n      } finally {\n        setTimeout(() => {\n          this.isLoading = false\n        }, 500)\n      }\n    },\n    formatDate(date) {\n      return dayjs(date).format('YYYY-MM-DD')\n    },\n    navigateToQuote() {\n      if (!this.product.total_gross_weight) {\n        uni.showToast({\n          title: '产品总毛重数据异常',\n          icon: 'none'\n        })\n        return\n      }\n      uni.navigateTo({\n        url: `/pages/quote/create?productId=${this.productId}&totalGrossWeight=${this.product.total_gross_weight}` \n      })\n    },\n    handleCartAction() {\n      if (this.isInCart) {\n        // 如果已在购物车中，可以导航到购物车页面\n        uni.navigateTo({ url: '/pages/cart/index' })\n      } else {\n        // 否则添加到购物车\n        this.addToCart()\n      }\n    },\n    async addToCart() {\n      const result = await this.cartAddToCart({\n        productId: this.productId,\n        productName: this.product.product_name\n      })\n      \n      uni.showToast({\n        title: result.message,\n        icon: result.success ? 'success' : 'none'\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '../../styles/theme.scss';\n\n.edit-container {\n  min-height: 100vh;\n  background-color: $bg-secondary;\n  padding: $spacing-md;\n}\n\n.content-wrapper {\n    display: flex;\n  flex-direction: column;\n  gap: 24rpx;\n}\n\n.page-header {\n  background-color: #fff;\n  padding: 30rpx;\n  border-radius: 12rpx;\n  margin-bottom: 24rpx;\n  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);\n  .page-title {\n    font-size: 36rpx;\n      font-weight: bold;\n      color: $text-primary;\n    margin-bottom: 12rpx;\n    display: block;\n  }\n  .page-subtitle {\n    font-size: 26rpx;\n    color: $text-secondary;\n  }\n}\n\n.form-card {\n  margin-bottom: 24rpx;\n}\n\n.form-content {\n  .form-row {\n    display: flex;\n    gap: $spacing-md;\n    margin-bottom: $spacing-md;\n    .product-image {\n      width: 160rpx;\n      height: 160rpx;\n      border-radius: 16rpx;\n      margin-right: $spacing-md;\n      background: #f5f5f5;\n      object-fit: cover;\n    }\n    .product-info-main {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 8rpx;\n      .product-title {\n        font-size: 32rpx;\n        font-weight: bold;\n        color: $text-primary;\n      }\n      .product-desc {\n        font-size: 26rpx;\n        color: $text-secondary;\n      }\n      .product-expiry {\n        font-size: 24rpx;\n        color: $text-secondary;\n    }\n  }\n}\n  .info-section {\n    margin-bottom: $spacing-lg;\n    .section-title {\n      font-size: $font-size-md;\n      font-weight: bold;\n      color: $text-primary;\n      margin-bottom: $spacing-sm;\n      display: block;\n    }\n    .info-grid {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: $spacing-md;\n    }\n    .info-item {\n      margin-bottom: $spacing-sm;\n      .label {\n        font-size: $font-size-sm;\n        color: $text-secondary;\n        margin-right: $spacing-xs;\n      }\n      .value {\n        font-size: $font-size-sm;\n        color: $text-primary;\n      }\n    }\n  }\n}\n\n/* 费用摘要卡片 */\n.summary-card {\n  background-color: #fff;\n  padding: 30rpx;\n  border-radius: 12rpx;\n  margin-bottom: 24rpx;\n  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);\n  .summary-title {\n    font-size: 30rpx;\n    font-weight: bold;\n    color: $text-primary;\n    margin-bottom: 24rpx;\n  }\n  .summary-item {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 16rpx;\n    .item-label {\n      font-size: 26rpx;\n      color: $text-secondary;\n    }\n    .item-value {\n      font-size: 26rpx;\n      color: $text-primary;\n    }\n    &.total {\n      .item-label {\n        font-size: 30rpx;\n        font-weight: 500;\n      }\n      .item-value {\n        font-size: 36rpx;\n        font-weight: bold;\n        color: #ff5252;\n      }\n    }\n  }\n  .summary-divider {\n    height: 1rpx;\n    background-color: #eee;\n    margin: 20rpx 0;\n  }\n}\n\n/* 底部按钮组 */\n.action-buttons {\n  display: flex;\n  gap: 24rpx;\n  margin-top: 20rpx;\n  padding: 30rpx;\n  background-color: white;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\n  .action-btn {\n    flex: 1;\n    height: 90rpx;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 45rpx;\n    font-size: 28rpx;\n    font-weight: 500;\n    .btn-icon {\n      margin-right: 12rpx;\n      font-size: 32rpx;\n    }\n    &.secondary {\n      background-color: rgba(#f44336, 0.1);\n      color: #f44336;\n      border: 2rpx solid rgba(#f44336, 0.3);\n    }\n    &.primary {\n      background-color: #1976D2;\n      color: white;\n      border: none;\n      box-shadow: 0 4rpx 16rpx rgba(#1976D2, 0.2);\n      &:disabled {\n        opacity: 0.7;\n        background-color: #999;\n        box-shadow: none;\n      }\n    }\n  }\n}\n</style> ","import MiniProgramPage from 'D:/orderMySelf/product-price/product-price/pages/product/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["mapState","mapGetters","uni","mapActions","dayjs"],"mappings":"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"}