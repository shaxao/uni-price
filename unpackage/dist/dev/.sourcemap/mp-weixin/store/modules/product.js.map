{"version":3,"file":"product.js","sources":["store/modules/product.js"],"sourcesContent":["import { get, post, put } from '../../utils/request'\r\n\r\n// 产品模块\r\nconst state = {\r\n  products: [],\r\n  currentProduct: null,\r\n  filteredProducts: [],\r\n  productFilter: {\r\n    sort: 'default', // default, priceAsc, priceDesc, dateNear, dateFar\r\n    category: null,\r\n    search: ''\r\n  },\r\n  loading: false,\r\n  error: null\r\n}\r\n\r\nconst mutations = {\r\n  SET_PRODUCTS(state, products) {\r\n    state.products = products\r\n  },\r\n  SET_FILTERED_PRODUCTS(state, products) {\r\n    state.filteredProducts = products\r\n  },\r\n  SET_CURRENT_PRODUCT(state, product) {\r\n    state.currentProduct = product\r\n  },\r\n  SET_PRODUCT_FILTER(state, filter) {\r\n    state.productFilter = { ...state.productFilter, ...filter }\r\n  },\r\n  SET_LOADING(state, status) {\r\n    state.loading = status\r\n  },\r\n  SET_ERROR(state, error) {\r\n    state.error = error\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 获取产品列表\r\n  async fetchProducts({ commit, dispatch }) {\r\n    commit('SET_LOADING', true)\r\n    try {\r\n      const response = await get('/products')\r\n      commit('SET_PRODUCTS', response.data || [])\r\n\r\n      // 应用当前筛选条件\r\n      dispatch('applyFilters')\r\n\r\n      return response.data\r\n    } catch (error) {\r\n      commit('SET_ERROR', error.message)\r\n      throw error\r\n    } finally {\r\n      commit('SET_LOADING', false)\r\n    }\r\n  },\r\n\r\n  // 获取产品详情\r\n  async fetchProductDetail({ commit }, productId) {\r\n    commit('SET_LOADING', true)\r\n    try {\r\n      const response = await get(`/products/${productId}`)\r\n      commit('SET_CURRENT_PRODUCT', response.data)\r\n      return response.data\r\n    } catch (error) {\r\n      commit('SET_ERROR', error.message)\r\n      throw error\r\n    } finally {\r\n      commit('SET_LOADING', false)\r\n    }\r\n  },\r\n\r\n  // 应用筛选条件\r\n  applyFilters({ commit, state }) {\r\n    let filtered = [...state.products]\r\n\r\n    // 关键词搜索\r\n    if (state.productFilter.search) {\r\n      const search = state.productFilter.search.toLowerCase()\r\n      filtered = filtered.filter(product =>\r\n        product.product_name.toLowerCase().includes(search) ||\r\n        (product.description && product.description.toLowerCase().includes(search))\r\n      )\r\n    }\r\n\r\n    // 分类筛选\r\n    if (state.productFilter.category) {\r\n      filtered = filtered.filter(product =>\r\n        product.category === state.productFilter.category\r\n      )\r\n    }\r\n\r\n    // 排序\r\n    switch (state.productFilter.sort) {\r\n      case 'priceAsc':\r\n        filtered.sort((a, b) => (a.price || 0) - (b.price || 0))\r\n        break\r\n      case 'priceDesc':\r\n        filtered.sort((a, b) => (b.price || 0) - (a.price || 0))\r\n        break\r\n      case 'dateNear':\r\n        filtered.sort((a, b) => {\r\n          const dateA = a.expiry_date ? new Date(a.expiry_date) : new Date(9999, 11, 31)\r\n          const dateB = b.expiry_date ? new Date(b.expiry_date) : new Date(9999, 11, 31)\r\n          return dateA - dateB\r\n        })\r\n        break\r\n      case 'dateFar':\r\n        filtered.sort((a, b) => {\r\n          const dateA = a.expiry_date ? new Date(a.expiry_date) : new Date(0)\r\n          const dateB = b.expiry_date ? new Date(b.expiry_date) : new Date(0)\r\n          return dateB - dateA\r\n        })\r\n        break\r\n    }\r\n\r\n    commit('SET_FILTERED_PRODUCTS', filtered)\r\n  },\r\n\r\n  // 更新筛选条件\r\n  updateFilter({ commit, dispatch }, filter) {\r\n    commit('SET_PRODUCT_FILTER', filter)\r\n    dispatch('applyFilters')\r\n  },\r\n\r\n  // 重置筛选条件\r\n  resetFilters({ commit, dispatch }) {\r\n    commit('SET_PRODUCT_FILTER', {\r\n      sort: 'default',\r\n      category: null,\r\n      search: ''\r\n    })\r\n    dispatch('applyFilters')\r\n  },\r\n\r\n  // 创建新产品（管理员功能）\r\n  async createProduct({ commit }, productData) {\r\n    commit('SET_LOADING', true)\r\n    try {\r\n      const response = await post('/products', productData)\r\n      return {\r\n        success: true,\r\n        data: response.data\r\n      }\r\n    } catch (error) {\r\n      commit('SET_ERROR', error.message)\r\n      return {\r\n        success: false,\r\n        message: error.message || '创建产品失败'\r\n      }\r\n    } finally {\r\n      commit('SET_LOADING', false)\r\n    }\r\n  },\r\n\r\n  // 更新产品（管理员功能）\r\n  async updateProduct({ commit }, { productId, data }) {\r\n    commit('SET_LOADING', true)\r\n    try {\r\n      const response = await put(`/products/${productId}`, data)\r\n      return {\r\n        success: true,\r\n        data: response.data\r\n      }\r\n    } catch (error) {\r\n      commit('SET_ERROR', error.message)\r\n      return {\r\n        success: false,\r\n        message: error.message || '更新产品失败'\r\n      }\r\n    } finally {\r\n      commit('SET_LOADING', false)\r\n    }\r\n  }\r\n}\r\n\r\nconst getters = {\r\n  productList: state => state.filteredProducts.length > 0 ? state.filteredProducts : state.products,\r\n  productById: state => id => state.products.find(p => p.product_id === id)\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions,\r\n  getters\r\n} "],"names":["state","product","get","post","put"],"mappings":"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"}